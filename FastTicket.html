<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Ticket</title>
</head>

<body class="flex">
    <div class="fast-ticket">
        <div class="wrapper ticket" id="ticketTarget">
            <div class="row separated-y-wrapper">
                <div class="col separated part ticket-part">Ticket</div>
                <div class="col separated part board-part">Board</div>
                <div class="col separated part grafana-part">Grafana</div>
                <div class="col separated part environment-part">Environnement</div>
            </div>
        </div>
        <button onclick="resetAll()">Reset</button>
    </div>

</body>

<script>
    const openUrl = (url) => {
        if (url) {
            window.open(url, "_blank");
        }
    }

    const resetAll = () => {
        document.querySelectorAll("input").forEach((input) => {
            input.value = "";
        })
    }

    // Ticket
    const ticketDict = {
        C30: {
            projectName: "ccv-p30",
            ticket: {
                inputId: "inputTicketC30",
            },
            board: {
                inputVersionId: "inputBoardVersionC30",
            },
            grafana: {
                prod: "abjJtwytrbds/logs-v2-prod",
                preprod: "abjJtwytrbds/logs-v2-preprod",
                version: "abjJtwytrbds/logs-v2-test?var-service_name=c30-test-backend&var-searchable_pattern=error",
                dev: "absdjJtwytrbds/logs-v2-dev?var-service_name=c30-test-backend&var-searchable_pattern=error",
            },
            environment: {
                prod: "https://c30.cchezvous.fr",
                preprod: "https://c30.staging.cchezvous.fr",
                version: "https://c30-test.staging.cchezvous.fr",
                dev: "https://c30-dev.staging.cchezvous.fr",
            },
        },
        X30: {
            projectName: "ccv-x30",
            ticket: {
                inputId: "inputTicketX30",
            },
            board: {
                inputVersionId: "inputBoardVersionX30",
            },
            grafana: {
                prod: "abjJtwbds/logs-v2-prod",
                preprod: "abjJtwbds/logs-v2-preprod",
                version: "abjJtwbds/logs-v2-test",
                dev: "abjJtwbdk/logs-v2-dev",
            },
            environment: {
                prod: "https://csuivi.cchezvous.fr",
                preprod: "https://csuivi.staging.cchezvous.fr",
                version: "https://csuivi-test.staging.cchezvous.fr",
                dev: "https://csuivi-dev.staging.cchezvous.fr",
            },
        },
        FCC: {
            projectName: "CCVOutilPrefacturation",
            ticket: {
                inputId: "inputTicketFCC",
            },
            board: {
                inputVersionId: "inputBoardVersionFCC",
            },
            grafana: {
                prod: "KoCKtQxSzAZ/logs-v2-prod",
                preprod: "KoCKtQxSzAZ/logs-v2-preprod",
                version: "KoCKtQxSzAZ/logs-v2-test",
                dev: "KoCKtQxSzAA/logs-v2-dev",
            },
            environment: {
                prod: "https://cregle.cchezvous.fr/version",
                preprod: "https://cregle.staging.cchezvous.fr/version",
                version: "https://cregle-test.staging.cchezvous.fr/version",
                dev: "https://cregle-dev.staging.cchezvous.fr/dev",
            },
        },
        MCC: {
            projectName: "ccv-mobility-middleware",
            ticket: {
                inputId: "inputTicketMCC",
            },
            board: {
                inputVersionId: "inputBoardVersionMCC",
            },
            grafana: {
                prod: "KoCKtQxSzAB/logs-v2-prod",
                preprod: "KoCKtQxSzAB/logs-v2-preprod",
                version: "KoCKtQxSzAB/logs-v2-test",
                dev: "KoCKtQxSzA/logs-v2-dev",
            },
        }
    }

    function onEnter(e, openTicket) {
        if (e.keyCode == 13) {
            openTicket();
        }
    }

    const getHtmlInput = (inputId, placeholder, open) => `
        <div>
            <input type="text" id="${inputId}" placeholder="${placeholder}" onkeydown="onEnter(event, ${open})">
            <button onclick="${open}()">Go !</button>
        </div>
    `;

    const getHtmlFastTicket = (projectName, props) => `
        <div class="row separated-y-wrapper">
            <div class="col separated part ticket-part">
                <div class="project">${projectName}</div>
                ${getHtmlInput(props.ticket.inputId, "Numéro de ticket", `ticketDict.${projectName}.ticket.openTicket`)}
            </div>
            <div class="col separated part board-part">
                <div>
                    <button onclick="ticketDict.${projectName}.board.openBoard()">Board</button>
                </div>
                ${getHtmlInput(props.board.inputVersionId, "Numéro de version", `ticketDict.${projectName}.board.openVersion`)}
            </div>
            <div class="col separated part grafana-part">
                ${getHtmlGrafana(props.grafana)}
            </div>
            <div class="col separated part environment-part">
                ${getEnvironmentHtml(props.environment)}
            </div>
        </div>
    `;

    const getHtmlGrafana = (grafana) => {
        let html = '';
        for (const env in grafana) {
            html += `
                <div class="col">
                    <button onclick="openUrl('https://ccv-wcv-grafana-outscale.${
                        env === 'version' || env === 'dev' ? 'test' : env
                    }.internal.dpdgroup.com/d/${grafana[env]}')">${env.toUpperCase()}</button>
                </div>
            `;
        }
        return html;
    };

    const getEnvironmentHtml = (environnement) => {
        if (!environnement) {
            return '';
        }

        let html = '';
        for (const key in environnement) {
            const url = environnement[key];
            if (!url) {
                continue;
            }
            html += `
                <div class="col">
                    <button onclick="openUrl('${environnement[key]}')">${key.toUpperCase()}</button>
                </div>
            `;
        }
        return html;
    }

    const ticketTarget = document.getElementById("ticketTarget");
    for (const key in ticketDict) {
        const properties = ticketDict[key];
        const baseUrl = `https://gitlab.com/solutec-cds-dev-projet/ccv/${properties.projectName}/-/`;
        // https://gitlab.com/groups/solutec-cds-dev-projet/ccv/-/wikis/FCC/ID
        properties.ticket["openTicket"] = () => {
            const value = document.getElementById(properties.ticket.inputId).value;
            if (!value) {
                return;
            }
            openUrl(`${baseUrl}issues/${value}`);
        }
        properties.board["openBoard"] = () => {
            openUrl(`${baseUrl}boards`);
        }
        properties.board["openVersion"] = () => {
            const value = document.getElementById(properties.board.inputVersionId).value;
            if (!value) {
                return;
            }
            openUrl(`${baseUrl}boards?milestone_title=Version ${value}`);
        }


        ticketTarget.innerHTML += getHtmlFastTicket(key, properties);
    }
</script>

<style>
    body {
        flex-direction: column;
        align-items: center;
        margin: 100px;
    }

    .flex,
    div {
        display: flex;
    }

    .wrapper {
        flex-direction: column;
    }

    .row {
        display: flex;
    }

    .col {
        display: flex;
    }

    .separated-y-wrapper {
        >.separated {
            border-right: 1px solid;
        }

        :first-child.separated {
            border-left: 1px solid;

        }
    }

    .fast-ticket {
        gap: 20px;

        >button {
            width: 80px;
        }

        .ticket {
            .part {
                justify-content: space-evenly;
                padding: 10px;
            }

            .ticket-part {
                width: 300px;
            }

            .board-part {
                width: 300px;
            }

            .grafana-part {
                width: 300px;
            }

            .environment-part {
                width: 300px;
            }

            .project {
                width: 20px;
                font-weight: bold;
            }
        }
    }
</style>

</html>